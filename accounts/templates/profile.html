{% extends "base.html" %} {% block page_content %}
<!-- prettier-ignore -->
{% load static %}

<main id="main">
  <div class="container">
    <div class="intro-info">
      {% if user.is_authenticated %}
      <div class="row">
        <div class="col-lg-10 mb-4">
          <h2>Welcome {{ user.get_short_name }}</h2>
        </div>
        <div class="col-lg-2 mb-4">
          <form action="/accounts/logout">
            <button type="submit" class="btn btn-dark">Log Out</button>
          </form>
        </div>
      </div>
      {% else %}
      <form id="login-page" action="{% url 'profile' %}">
        <button type="submit" form="login-page" title="Login">
          Login to see your queries
        </button>
      </form>
      {% endif %}
    </div>
  </div>
  <div class="container">
    {% if user.is_authenticated %}
    <section id="contact">
      <div class="form">
        <div id="sendmessage">Your message has been sent. Thank you!</div>
        <div id="errormessage"></div>
        <form
          action="/contactform/"
          method="post"
          role="form"
          class="contactForm"
        >
          {% csrf_token %}
          <div class="form-group">
            <select
              class="form-control"
              id="service"
              name="service"
              data-rule="required"
              data-msg="Please choose a valid service"
            >
              <option value="" disabled selected>Service</option>
              {% for service in services %}
              <option value="{{ service.pk}}">{{ service }}</option>
              {% endfor %}
            </select>
            <div class="validation"></div>
          </div>
          <div class="form-group">
            <input
              type="text"
              class="form-control"
              name="subject"
              id="subject"
              placeholder="Subject"
              data-rule="minlen:4"
              data-msg="Please enter at least 8 chars of subject"
            />
            <div class="validation"></div>
          </div>
          <div class="form-group">
            <textarea
              class="form-control"
              name="message"
              rows="5"
              data-rule="required"
              data-msg="Please write something for us"
              placeholder="Message"
            ></textarea>
            <div class="validation"></div>
          </div>
          <div class="text-center">
            <button type="submit" title="Send Message">
              Send Message
            </button>
          </div>
        </form>
      </div>
    </section>
    <h3>Your Chats</h3>
    <div class="container">
      <div class="card-columns">
        {% for query in queries %}
        <div class="card bg-light mb-3" style="max-width: 18rem;">
          <div class="card-header">
            By
            <var>{{ query.user }}</var>
            on {{ query.created_at }}
          </div>
          <div class="card-body">
            <h5 class="card-title">{{ query.service }}</h5>
            <p class="card-text">
              <strong>Subject:</strong> <i>{{ query.subject }}</i>
              <br />
              <strong>Resolved: {{ query.resolved }}</strong>
              <br />
              <a href="{% url 'query' query.pk %}">Continue Chat</a>
            </p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</main>

{% endblock %}
